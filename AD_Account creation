#Importing Active Directory

Import-Module ActiveDirectory

#Get User name and pwd
function Get-Creds
{
$firstname = Read-Host -Prompt "Enter your first name"
$secondname = Read-Host -Prompt "Enter your second name"
$password = Read-Host -Prompt "Enter your password"
}

#Output creds for confirmation

echo "Hi $firstname $secondname, your password is $password "
$Readhost = Read-Host -Prompt "Is this correct (y/n)?"  

Switch ($ReadHost) 
     { 
       y {Write-host "Thanks for confirming. Creating your AD account......."; $PublishSettings=$true} 
       n {
          Write-Host "Please re-enter your credentials"
          Get-Job -Name Get-Creds | Receive-Job 
          } 
       Default {Write-Host "Invalid input"} 
     } 

#Specify the path

$OUpath = "OU=Powershell users,DC=test,DC=com"

#Convert password to secure string

$securePwd = ConvertTo-SecureString $password -AsPlainText -Force

#Create AD account

New-ADuser -Name "$firstname $lastname" -GivenName $firstname -Surname $lastname -UserPrincipalName "$firstname.$lastname" -Path $OUpath -AccountPassword $securePwd -ChangePasswordAtLogon $true

Write-Host "AD account successfully created..... Make sure to change the password upon first login"
